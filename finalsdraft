#include <iostream>
#include <string.h>
#include <unistd.h>
#include <windows.h>
#include <conio.h>
#include <fstream>
#include <vector>
#include <string>
#include <set>
#include <algorithm>

using namespace std;
struct User{
string name;
string username;
string password;
string role;
};
vector<User> users;


class Car{
    public:
string brand;
string model;
 vector<string> platenum;
string rentalcost;
bool availability;


Car(string b, string m, vector<string> p, string cost){
brand = b;
model = m;
platenum = p;
rentalcost = cost;
availability = true;
}

bool isAvailable() const {
        return !platenum.empty();
    }
bool removePlate(const string& plate) {
        auto it = find(platenum.begin(), platenum.end(), plate);
        if (it != platenum.end()) {
            platenum.erase(it);
            return true;
        }
        return false;
    }
void display() const{
cout << "Brand: " << brand
<< " | |" << "\tModel: " << model
<< " \t| |" << "\tPlate Number: ";
        for(size_t i = 0; i < platenum.size(); ++i) {
            cout << platenum[i];
            if (i < platenum.size() - 1) cout << ", ";
        }
cout << " \t| | Rental Cost: ₱" << rentalcost
<< " \t| |" << "\tStatus: " << (availability ? "Available" : "Rented/Not Avaiable") << endl;
}

};

void seedDefaultUsers() {
    User defaultAdmin;
    User defaultEmployee;
    User defaultCostumer;
    defaultAdmin.name = "ADMIN MARK";
    defaultAdmin.username = "admin";
    defaultAdmin.password = "a";
    defaultAdmin.role = "admin";
    users.push_back(defaultAdmin);

    defaultEmployee.name = "Mark Alcayde";
    defaultEmployee.username = "a";
    defaultEmployee.password = "a";
    defaultEmployee.role = "employee";
    users.push_back(defaultEmployee);

    defaultCostumer.name = "Costumer Mark";
    defaultCostumer.username = "q";
    defaultCostumer.password = "q";
    defaultCostumer.role = "costumer";
    users.push_back(defaultCostumer);
}
class rentsys{
private:
    vector<Car> cars;

public:
    void allcars(){
    cars.push_back(Car("Toyota", "Vios, Innova, Fortuner",{"CDB 4634", "UBT 4667", "UBT 3676"}, "2,500 - 4,500"));
    cars.push_back(Car("Honda", "City, Civic, CR-V",{"TTC 3871", "TTK 4437", "TTY 8778"}, "2,500 - 4,500"));
    cars.push_back(Car("Mitsubishi", "Mirage, Montero Sport",{"GPE 2397,", "EPG 7072", "JPR 7301"}, "2,000 – 4,000"));
    cars.push_back(Car("Nissan", "Almera, Navara, Terra",{"CTC 2573", "CYO 7971", "OYS 8310"}, "2,500 - 4,500"));
    cars.push_back(Car("Hyundai", "Accent, Tucson", {"CTC 2573", "CYO 7971", "OYS 8310"}, "2,500 – 4,500"));
    cars.push_back(Car("Kia", " Picanto, Sportage",{"TYC 0001", "YSY 7281"}, "2,000 – 4,000"));
    cars.push_back(Car("Ford", "Ranger, Everest",{"YTY 8282", "POA 0911"}, "3,000 – 5,000"));
    cars.push_back(Car("Chevrolet", "Spark, Trailblazer",{"MMO 3311,", "MMM 0098"}, "2,500 – 4,500"));
    cars.push_back(Car("Mazda", "Mazda 2, CX-5",{" POT 9821", "NXT 8882"}, "2,500 – 4,500"));
    cars.push_back(Car("Suzuki", "Swift, Ertiga",{"SWD 7272", "MMA 8766"}, "2,000 – 3,500"));
    cars.push_back(Car("Subaru", "Forester, XV",{"MOA 6612", "MAL 0043"}, "3,000 – 5,000"));
    cars.push_back(Car("Volkswagen", "3 Series, X3",{"NEU 7722", "NYW 7627"}, "5,000 – 8,000"));
    cars.push_back(Car("BMW", "City, Civic, CR-V",{"TTC 3871", "TTK 4437", "TTY 8778"}, "2,500 - 4,500"));
    cars.push_back(Car("Mercedes-Benz", "C-Class, GLC",{"POA 7621", "TOL 7509"}, "6,000 – 9,000"));
    cars.push_back(Car("Audi", "A4, Q5",{"AUK 0493", "KOM 7784"}, "6,000 – 9,000"));
    cars.push_back(Car("Lexus", "ES, RX",{"KOW 8822", "MOL 9928"}, "6,000 – 9,000"));
    cars.push_back(Car("Isuzu", "D-Max, mu-X",{"NTX 2891", "TOP 2938"}, "3,000 – 5,000"));
    cars.push_back(Car("Chery", "Tiggo Series",{"POL 9273",  "HGF 0192"}, "2,500 – 4,000"));
    cars.push_back(Car("Geely", "Coolray, Azkarra",{"OWT 0129", "YUT 8778"}, "2,500 – 4,000"));
    cars.push_back(Car("Foton", "Gratour, Toano",{"OIW 0987", "EWM 8789"}, "2,500 – 4,500"));
    }

    void chooseCarBrand() {
    set<string> uniqueBrands;
    vector<string> brandList;


    for (const auto& car : cars) {
        uniqueBrands.insert(car.brand);
    }

    brandList.assign(uniqueBrands.begin(), uniqueBrands.end());


    cout << "\nAvailable Car Brands:\n";
    for (size_t i = 0; i < brandList.size(); ++i) {
        cout << "[" << i + 1 << "] " << brandList[i] << endl;
    }


    int selectedIndex;
    cout << "\nEnter the number of the brand you want to view: ";
    cin >> selectedIndex;

    if (selectedIndex < 1 || selectedIndex > (int)brandList.size()) {
        cout << "Invalid selection.\n";
        return;
    }

    string selectedBrand = brandList[selectedIndex - 1];
    cout << "\n--- Cars for Brand: " << selectedBrand << " ---\n";

    bool found = false;
    for (const auto& car : cars) {
        if (car.brand == selectedBrand && car.availability) {
            car.display();
            found = true;
        }
    }

    if (!found) {
        cout << "No available cars for this brand.\n";
    }

    cout << "\nPress any key to return to menu...";
    getch();
    system("cls");
}
vector<Car>& getCars() {
        return cars;
    }
    };


void admin();
void costumer(User& costumer);
void employee(const User& employee);
void welcome();


void loadingscreen(){

cout << "Hello";
cin.get();

system("cls");
return;


}

rentsys rentalSystem;
void rentCar(User& costumer) {
    system("cls");
    cout << "--- Rent a Car ---" << endl;

    vector<Car>& cars = rentalSystem.getCars();
    set<string> uniqueBrands;

  
    for (const auto& car : cars) {
        if (car.isAvailable()) {
            uniqueBrands.insert(car.brand);
        }
    }

    if (uniqueBrands.empty()) {
        cout << "No available cars to rent.\n";
        system("pause");
        system("cls");
        return;
    }

   
    vector<string> brandList(uniqueBrands.begin(), uniqueBrands.end());
    cout << "\nAvailable Car Brands:\n";
    for (size_t i = 0; i < brandList.size(); ++i) {
        cout << "[" << i + 1 << "] " << brandList[i] << endl;
    }

    int brandChoice;
    cout << "\nEnter the number of the brand you want to view: ";
    cin >> brandChoice;

    if (brandChoice < 1 || brandChoice > (int)brandList.size()) {
        cout << "Invalid selection.\n";
        system("pause");
        system("cls");
        return;
    }

    string selectedBrand = brandList[brandChoice - 1];
    cout << "\n--- Cars for Brand: " << selectedBrand << " ---\n";

    
    vector<Car> availableCars;
    for (auto& car : cars) {
        if (car.brand == selectedBrand && car.isAvailable()) {
            car.display();
            availableCars.push_back(car);
        }
    }

    if (availableCars.empty()) {
        cout << "No available cars for this brand.\n";
        system("pause");
        system("cls");
        return;
    }

    
    vector<string> allPlates;
    for (const auto& car : availableCars) {
        for (const auto& plate : car.platenum) {
            allPlates.push_back(plate);
        }
    }

    cout << "\nAvailable Plate Numbers:\n";
    for (size_t i = 0; i < allPlates.size(); ++i) {
        cout << "[" << i + 1 << "] " << allPlates[i] << endl;
    }

    int plateChoice;
    cout << "\nEnter the number of the plate you want to rent: ";
    cin >> plateChoice;

    if (plateChoice < 1 || plateChoice > (int)allPlates.size()) {
        cout << "Invalid selection.\n";
        system("pause");
        system("cls");
        return;
    }

    string chosenPlate = allPlates[plateChoice - 1];

   
    bool plateFound = false;
    for (auto& car : cars) {
        if (find(car.platenum.begin(), car.platenum.end(), chosenPlate) != car.platenum.end()) {
            if (car.isAvailable()) {
                car.removePlate(chosenPlate); 
                car.availability = false; 
                cout << "Car with plate " << chosenPlate << " rented successfully!\n";
                plateFound = true;
                break;
            } else {
                cout << "The car with plate " << chosenPlate << " is already rented.\n";
                plateFound = true;
                break;
            }
        }
    }

    if (!plateFound) {
        cout << "Plate number not found or already rented.\n";
    }

    system("pause");
    system("cls");
}



void loginpage(){
    int cont;
    char ch;
    bool error = false;
    bool loggedIn = false;

    string inputusername, inputpassword;
    while(true){
            if(error == true){
    cout << "Credentials Mismatched!" << endl;
}
cout << "Welcome to Mark's Car Rental" << endl;

cout << "Please log in" << endl << endl;
cout << "Username: ";
cin >> inputusername;
cout << "Password: ";
 inputpassword = "";
while ((ch = _getch()) != '\r'){
        if (ch == '\b') {
            if (!inputpassword.empty()) {
               inputpassword.erase(inputpassword.size() - 1);
                cout << "\b \b";
            }
        } else {
            inputpassword += ch;
            cout << '*';
        }
    }
    cout << "\n\nDo you wish to continue? [1] Log In, [2] Back (choice): ";
    cin >> cont;
    cin.clear();

    switch(cont){
   case 1:
    for (auto& user : users) {
    if (user.username == inputusername && user.password == inputpassword) {
            error = false;
            loggedIn = true;
        if (user.role == "admin") {
                system("cls");
            admin();
        } else if (user.role == "costumer") {
            system("cls");
            costumer(user);
        } else if (user.role == "employee"){
            system("cls");
        employee(user);
        }

        return;
    }

}
  if (!loggedIn) {
        error = true;
        system("cls");
        break;
    }
   case 2:
    cout << "Please wait";
    sleep(1);
    welcome();
    break;

   default:
    cout << "Invalid choices";
    break;
    }

system("cls");


}
system("cls");
}

void registerpage(){
User newUser;
    cout << "=== Register Account ===" << endl;
    cout << "Enter your name: ";
    cin.ignore();
    getline(cin, newUser.name);

    cout << "Choose a username: ";
    cin >> newUser.username;

    cout << "Choose a password: ";
    newUser.password = "";
    char ch;
    while ((ch = _getch()) != '\r') {
        if (ch == '\b') {
            if (!newUser.password.empty()) {
                newUser.password.pop_back();
                cout << "\b \b";
            }
        } else {
            newUser.password += ch;
            cout << '*';
        }
    }
    cout << endl;

    newUser.role = "costumer";

    for (const auto& user : users) {
        if (user.username == newUser.username) {
            cout << "Username already exists. Please try again.\n";
            Sleep(1500);
            system("cls");
            return;
        }
    }

    users.push_back(newUser);
    cout << "Account successfully created! You can now log in.\n";
    Sleep(1500);
    system("cls");
    welcome();

}

void welcome(){
    int choice;
    while(choice != 3){
cout << "Welcome to Mark's Car Rental" << endl;
cout << "[1] Login" << endl;
cout << "[2] Signup" << endl;
cout << "[3] Exit" << endl;
cout << "Choice: ";
cin >> choice;

switch(choice){
   case 1:
       system("cls");
       loginpage();
       break;
   case 2:
       system("cls");
    registerpage();
    break;
   case 3:
       cout << "Exiting Mark's Car Rental, Thank You";
       sleep(1);
       system("cls");
    exit(0);
    break;
   default:
    cout << "Invalid, Please choose 1, 2 or 3" << endl;
    break;
}
}
}

void admin(){

cout << "admin test";
system("pause");
system("cls");
}



void costumer(User& costumer){
int choice;
string plate;
vector<string> brandlist;

while(true){
    cout << "Hello costumer, " << costumer.name << endl;
    cout << "[1] View available cars" << endl;
    cout << "[2] Rent Cars" << endl;
    cout << "[3] History" << endl;
    cout << "[4] Logout" << endl;
    cout << "Choose: ";
    cin >> choice;

    switch(choice){
case 1:
    system("cls");
    rentalSystem.chooseCarBrand();
    break;
case 2:
    rentCar(const_cast<User&>(costumer));  
    break;
    }
}
}

void employee(const User& employee){

cout << "employee test" << "\t" << employee.name;
system("pause");
system("cls");
}

int main(){
system("chcp 65001");
//loadingscreen();
 rentalSystem.allcars();
 seedDefaultUsers();
 welcome();
return 0;
}
